/* @marcbachmann/cel-js | MIT License | https://github.com/marcbachmann/cel-js */
var y=class extends Error{#e=!1;constructor(e,n,r){super(e,{cause:r}),this.name="ParseError",n?.input&&(this.#e=!0,this.message=S(this.message,n))}withAst(e){return this.#e?this:e?.input?(this.message=S(this.message,e),this):this}},l=class extends Error{#e=!1;constructor(e,n,r){super(e,{cause:r}),this.name="EvaluationError",n?.input&&(this.#e=!0,this.message=S(this.message,n))}withAst(e){return this.#e?this:e?.input?(this.message=S(this.message,e),this):this}},d=class extends Error{#e=!1;constructor(e,n,r){super(e,{cause:r}),this.name="TypeError",n?.input&&(this.#e=!0,this.message=S(this.message,n))}withAst(e){return this.#e?this:e?.input?(this.message=S(this.message,e),this):this}};function S(t,e){if(e?.pos===void 0)return t;let n=e.pos,r=e.input,s=1,i=0,o=0;for(;i<n;)r[i]===`
`?(s++,o=0):o++,i++;let c=n,h=n;for(;c>0&&r[c-1]!==`
`;)c--;for(;h<r.length&&r[h]!==`
`;)h++;let g=r.slice(c,h),T=`${s}`.padStart(4," "),N=" ".repeat(9+o);return`${t}

> ${T} | ${g}
${N}^`}var w=class{#e;constructor(e){this.#e=e,Object.freeze(this)}get name(){return this.#e}get[Symbol.toStringTag](){return`Type<${this.#e}>`}toString(){return`Type<${this.#e}>`}},O={string:new w("string"),bool:new w("bool"),int:new w("int"),uint:new w("uint"),double:new w("double"),map:new w("map"),list:new w("list"),bytes:new w("bytes"),null_type:new w("null"),type:new w("type"),google:{protobuf:{Timestamp:new w("google.protobuf.Timestamp"),Duration:new w("google.protobuf.Duration")}}};O["google.protobuf.Timestamp"]=O.google.protobuf.Timestamp;O["google.protobuf.Duration"]=O.google.protobuf.Duration;var M=class{constructor({kind:e,type:n,name:r,keyType:s,valueType:i,values:o}){this.kind=e,this.type=n,this.name=r,s&&(this.keyType=s),i&&(this.valueType=i),o&&(this.values=o),e==="list"?this.fieldLazy=this.#r:e==="map"?this.fieldLazy=this.#t:e==="message"?this.fieldLazy=this.#e:e==="dyn"&&(this.fieldLazy=this.#t),Object.freeze(this)}isDynOrBool(){return this.type==="bool"||this.kind==="dyn"}toString(){return this.name}#e(e,n,r,s){let i=s.objectTypesByConstructor.get(e.constructor);if(!i)return;if(!i.fields)return Object.hasOwn(e,n)?e[n]:void 0;let o=i.fields[n];if(!o)return;let c=e[n];if(o.kind==="dyn")return c;let h=s.debugType(c);if(o.matches(h))return c;throw new l(`Field '${n}' is not of type '${o}', got '${h}'`,r)}#t(e,n,r,s){let i;if(e instanceof Map?i=e.get(n):i=Object.hasOwn(e,n)?e[n]:void 0,i===void 0)return;if(this.valueType.kind==="dyn")return i;let o=s.debugType(i);if(this.valueType.matches(o))return i;throw new l(`Field '${n}' is not of type '${this.valueType}', got '${o}'`,r)}#r(e,n,r,s){if(typeof n=="number"||typeof n=="bigint"){let i=e[n];if(i!==void 0){if(this.valueType.kind==="dyn")return i;let o=s.debugType(i);if(this.valueType.matches(o))return i;throw new l(`List item with index '${n}' is not of type '${this.valueType}', got '${o}'`,r)}if(n<0)throw new l(`No such key: index out of bounds, index ${n} < 0`,r);if(n>=e.length)throw new l(`No such key: index out of bounds, index ${n} >= size ${e.length}`,r)}}fieldLazy(){}field(e,n,r,s){let i=this.fieldLazy(e,n,r,s);if(i!==void 0)return i;throw new l(`No such key: ${n}`,r)}matches(e){if(this===e||e.name==="dyn")return!0;switch(this.kind){case"dyn":return!0;case"list":return e.kind==="list"&&this.valueType.matches(e.valueType);case"map":return e.kind==="map"&&this.keyType.matches(e.keyType)&&this.valueType.matches(e.valueType);default:return this.name===e.name}}},Y=class{constructor({name:e,receiverType:n,argTypes:r,returnType:s,handler:i,typeCheck:o}){this.name=e,this.macro=r.includes(Q),this.receiverType=n||null,this.argTypes=r,this.returnType=s;let c=n?`${n}.`:"";this.signature=`${c}${e}(${r.join(", ")}): ${s}`,this.handler=i,this.typeCheck=o,Object.freeze(this)}matchesArgs(e){return e.length!==this.argTypes.length?!1:this.argTypes.every((n,r)=>n.matches(e[r]))}},I=class{constructor({operator:e,leftType:n,rightType:r,handler:s,returnType:i}){this.operator=e,this.leftType=n,this.rightType=r||null,this.handler=s,this.returnType=i,r?this.signature=`${n} ${e} ${r}: ${i}`:this.signature=`${e}${n}: ${i}`,Object.freeze(this)}get isUnary(){return this.rightType===null}get isBinary(){return this.rightType!==null}equals(e){return this.operator===e.operator&&this.leftType===e.leftType&&this.rightType===e.rightType}};function ne(t){return new M({kind:"list",name:`list<${t}>`,type:"list",valueType:t})}function x(t){return new M({kind:"primitive",name:t,type:t})}function qe(t){return new M({kind:"message",name:t,type:t})}function Ee(t){let e=t?`dyn<${t}>`:"dyn";return new M({kind:"dyn",name:e,type:e,valueType:t})}function re(t,e){return new M({kind:"map",name:`map<${t}, ${e}>`,type:"map",keyType:t,valueType:e})}var b=Ee(),Q=x("ast"),G=Object.freeze({string:x("string"),bool:x("bool"),int:x("int"),uint:x("uint"),double:x("double"),bytes:x("bytes"),dyn:b,null:x("null"),type:x("type"),"google.protobuf.Timestamp":x("google.protobuf.Timestamp"),"google.protobuf.Duration":x("google.protobuf.Duration"),list:ne(b),"list<dyn>":ne(b),map:re(b,b),"map<dyn, dyn>":re(b,b)}),W=class{#e=[];exists=!1;hasMacro=!1;add(e){this.exists=!0,e.macro&&(this.hasMacro=!0),this.#e.push(e)}get functions(){return this.#e}findMatch(e){if(!this.exists)return null;for(let n of this.#e)if(n.matchesArgs(e))return n;return null}},be=new W,se=class{exists=!1;hasMacro=!1;returnType=null;#e=new Map;add(e){this.exists=!0,e.macro&&(this.hasMacro=!0),this.returnType?e.typeCheck?this.returnType=b:this.returnType!==e.returnType&&(this.returnType=b):this.returnType=e.returnType;let n=e.receiverType;(this.#e.get(n)||this.#e.set(n,new W).get(n)).add(e)}filterByReceiverType(e){return e===null?this.#e.get(null)||be:this.#e.get(e)||(e.type==="list"||e.type==="map"?this.#e.get(G[e.type]):null)||be}};function ve(t){let e=[],n="",r=0;for(let s of t){if(s==="<")r++;else if(s===">")r--;else if(s===","&&r===0){e.push(n),n="";continue}n+=s}return n&&e.push(n),e}var Ke=new Set(Object.keys(O)).add("null").add("dyn");Ke.delete("google");function V(t){if(t===null||typeof t!="object")return t;if(Array.isArray(t))return t.map(V);if(t instanceof Map)return new Map([...t].map(([n,r])=>[n,V(r)]));if(t instanceof Set)return new Set([...t].map(V));if(t.constructor&&t.constructor!==Object)return t;let e=Object.create(Object.getPrototypeOf(t));for(let n of Object.keys(t))e[n]=V(t[n]);return e}var ie=class t{#e=null;#t;#r;#i;#n;constructor({typeDeclarations:e,...n}={}){n=V(n||{}),this.#t=n.objectTypes??new Map,this.#r=n.objectTypesByConstructor??new Map,this.#i=n.objectTypeInstances??new Map,this.#n=new Map(e||Object.entries(G))}get overloads(){if(this.#e)return this.#e;let e={};for(let[,n]of this.#n){if(!(n instanceof I))continue;let r=e[n.operator]??=new Map;n.isUnary?r.set(n.leftType,{handler:n.handler,returnType:n.returnType}):(r.get(n.leftType)||r.set(n.leftType,new Map).get(n.leftType)).set(n.rightType,{handler:n.handler,returnType:n.returnType})}return this.#e=e,e}#o(){this.#e=null}getFunctionCandidates(e,n,r){let s=new se;for(let[,i]of this.#n)i instanceof Y&&n===i.name&&(e===null&&i.receiverType||e&&i.receiverType===null||(s.exists=!0,i.macro&&(s.hasMacro=!0),!(e&&!e.matches(i.receiverType))&&i.argTypes.length===r&&s.add(i)));return s}get objectTypes(){return this.#t}get objectTypesByConstructor(){return this.#r}get objectTypeInstances(){return this.#i}getType(e){return this.#s(e,!0)}getVerifiedType(e){return this.#n.get(e)}assertType(e,n,r){try{return this.#s(e,!0)}catch(s){throw s.message=`Invalid ${n} '${s.unknownType||e}' in '${r}'`,s}}getFunctionType(e){return e==="ast"?Q:this.#s(e,!0)}registerType(e,n,r){let s={name:e,type:this.#s(e,!1),ctor:typeof n=="function"?n:n?.ctor,fields:this.#f(e,n?.fields)};if(!r){if(this.#t.has(e))throw new Error(`Type already registered: ${e}`);if(typeof s.ctor!="function")throw new Error(`Constructor function missing for type '${e}'`)}if(this.#t.set(e,s),this.#r.set(s.ctor,s),r)return;let i=new w(e);this.#i.set(e,i),this.registerFunctionOverload(`type(${e}): type`,()=>i)}#s(e,n=!1){let r=this.#n.get(e);if(r)return r;let s=e.match(/^dyn<(.+)>$/);if(s){let c=this.#s(s[1].trim(),n);return this.#a(c)}let i=e.match(/^list<(.+)>$/);if(i){let c=this.#s(i[1].trim(),n);return this.#c(c)}let o=e.match(/^map<(.+)>$/);if(o){let c=ve(o[1]);if(c.length!==2)throw new Error(`Invalid map type: ${e}`);let h=this.#s(c[0].trim(),n),g=this.#s(c[1].trim(),n);return this.#h(h,g)}if(n){let c=new Error(`Unknown type: ${e}`);throw c.unknownType=e,c}return this.#u(e)}#u(e){return this.#n.get(e)||this.#n.set(e,qe(e)).get(e)}#a(e){let n=`dyn<${e}>`;return this.#n.get(n)||this.#n.set(n,Ee(e)).get(n)}#c(e){let n=`list<${e}>`;return this.#n.get(n)||this.#n.set(n,ne(e)).get(n)}#h(e,n){let r=`map<${e}, ${n}>`;return this.#n.get(r)||this.#n.set(r,re(e,n)).get(r)}#p(e,n,r,s=!1){try{let i=typeof n[r]=="string"?{type:n[r]}:{...n[r]};if(typeof i?.type!="string")throw new Error("unsupported declaration");return this.#s(i.type,s)}catch(i){throw i.message=`Field '${r}' in type '${e}' has unsupported declaration: ${JSON.stringify(n[r])}`,i}}#f(e,n){if(!n)return;let r={};for(let s of Object.keys(n))r[s]=this.#p(e,n,s);return r}clone(){return new t({objectTypes:this.#t,objectTypesByConstructor:this.#r,objectTypeInstances:this.#i,typeDeclarations:this.#n})}#g(e,n,r){let s=e.match(/^(?:([a-zA-Z0-9.]+)\.)?(\w+)\((.*?)\):\s*(.+)$/);if(!s)throw new Error(`Invalid signature: ${e}`);let[,i,o,c,h]=s;try{return new Y({name:o,receiverType:i?this.getType(i.trim()):null,returnType:this.getType(h.trim()||"dyn"),argTypes:ve(c).map(g=>this.getFunctionType(g.trim())),handler:n,typeCheck:r})}catch{throw new Error(`Invalid function declaration: ${e}`)}}#y(e,n){return e.name!==n.name||e.argTypes.length!==n.argTypes.length||(e.receiverType||n.receiverType)&&(!e.receiverType||!n.receiverType)?!1:!(e.receiverType!==n.receiverType&&e.receiverType!==b&&n.receiverType!==b)&&(n.macro||e.macro||n.argTypes.every((s,i)=>{let o=e.argTypes[i];return s===o||s===Q||o===Q||s===b||o===b}))}#d(e){for(let[,n]of this.#n)if(n instanceof Y&&this.#y(n,e))throw new Error(`Function signature '${e.signature}' overlaps with existing overload '${n.signature}'.`)}registerFunctionOverload(e,n){let r=typeof n=="function"?n:n.handler,s=typeof n=="function"?{}:n,i=this.#g(e,r,s.typeCheck);this.#d(i),this.#n.set(i.signature,i)}registerOperatorOverload(e,n){let r=e.match(/^([-!])([\w.<>]+)(?::\s*([\w.<>]+))?$/);if(r){let[,g,T,N]=r;return this.unaryOverload(g,T,n,N)}let s=e.match(/^([\w.<>]+) ([-+*%/]|==|!=|<|<=|>|>=|in) ([\w.<>]+)(?::\s*([\w.<>]+))?$/);if(!s)throw new Error(`Operator overload invalid: ${e}`);let[,i,o,c,h]=s;return this.binaryOverload(i,o,c,n,h)}unaryOverload(e,n,r,s){let i=this.assertType(n,"type",`${e}${n}`),o=this.assertType(s||n,"return type",`${e}${n}: ${s||n}`),c=new I({operator:`${e}_`,leftType:i,returnType:o,handler:r});if(this.#l(c))throw new Error(`Operator overload already registered: ${e}${n}`);this.#n.set(c.signature,c),this.#o()}#l(e){for(let[,n]of this.#n)if(n instanceof I&&e.equals(n))return!0;return!1}binaryOverload(e,n,r,s,i){i||($e(n)?i="bool":i=e);let o=`${e} ${n} ${r}: ${i}`,c=this.assertType(e,"left type",o),h=this.assertType(r,"right type",o),g=this.assertType(i,"return type",o);if($e(n)&&g.type!=="bool")throw new Error(`Comparison operator '${n}' must return 'bool', got '${g.type}'`);let T=new I({operator:n,leftType:c,rightType:h,returnType:g,handler:s});if(this.#l(T))throw new Error(`Operator overload already registered: ${T.signature}`);if(n==="=="){let N=[new I({operator:"==",leftType:h,rightType:c,handler(k,F,P,z){return s(F,k,P,z)},returnType:g}),new I({operator:"!=",leftType:c,rightType:h,handler(k,F,P,z){return!s(k,F,P,z)},returnType:g}),new I({operator:"!=",leftType:h,rightType:c,handler(k,F,P,z){return!s(F,k,P,z)},returnType:g})];for(let k of N)if(this.#l(k))throw new Error(`Operator overload already registered: ${k.signature}`);for(let k of N)this.#n.set(k.signature,k)}this.#n.set(T.signature,T),this.#o()}};function $e(t){return t==="<"||t==="<="||t===">"||t===">="||t==="=="||t==="!="||t==="in"}function Qe(t){return new ie(t)}var R=Qe();var a={EOF:0,NUMBER:1,STRING:2,BOOLEAN:3,NULL:4,IDENTIFIER:5,PLUS:6,MINUS:7,MULTIPLY:8,DIVIDE:9,MODULO:10,EQ:11,NE:12,LT:13,LE:14,GT:15,GE:16,AND:17,OR:18,NOT:19,IN:20,LPAREN:21,RPAREN:22,LBRACKET:23,RBRACKET:24,LBRACE:25,RBRACE:26,DOT:27,COMMA:28,COLON:29,QUESTION:30,BYTES:31},f=class extends Array{#e;#t;constructor(e,n,r){super(),this.#e=e,this.#t=n,this.push(...r)}get input(){return this.#t}get pos(){return this.#e}},J={};for(let t in a)J[a[t]]=t;var We=new Set(["as","break","const","continue","else","for","function","if","import","let","loop","package","namespace","return","var","void","while"]),xe=new Uint8Array(256);for(let t of"0123456789abcdefABCDEF")xe[t.charCodeAt(0)]=1;var oe=new Uint8Array(256);for(let t of"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_")oe[t.charCodeAt(0)]=1;var ke={"\\":"\\","?":"?",'"':'"',"'":"'","`":"`",a:"\x07",b:"\b",f:"\f",n:`
`,r:"\r",t:"	",v:"\v"},ae=class{constructor(e){this.input=e,this.pos=0,this.length=e.length}nextToken(){if(this.pos>=this.length)return{type:a.EOF,value:null,pos:this.pos};let e=this.input[this.pos],n=this.input[this.pos+1];switch(e){case" ":case"	":case`
`:case"\r":return this.pos++,this.nextToken();case"=":if(n!=="=")break;return{type:a.EQ,value:"==",pos:(this.pos+=2)-2};case"&":if(n!=="&")break;return{type:a.AND,value:"&&",pos:(this.pos+=2)-2};case"|":if(n!=="|")break;return{type:a.OR,value:"||",pos:(this.pos+=2)-2};case"+":return{type:a.PLUS,value:"+",pos:this.pos++};case"-":return{type:a.MINUS,value:"-",pos:this.pos++};case"*":return{type:a.MULTIPLY,value:"*",pos:this.pos++};case"/":if(n==="/"){for(;this.pos<this.length&&this.input[this.pos]!==`
`;)this.pos++;return this.nextToken()}return{type:a.DIVIDE,value:"/",pos:this.pos++};case"%":return{type:a.MODULO,value:"%",pos:this.pos++};case"<":return n==="="?{type:a.LE,value:"<=",pos:(this.pos+=2)-2}:{type:a.LT,value:"<",pos:this.pos++};case">":return n==="="?{type:a.GE,value:">=",pos:(this.pos+=2)-2}:{type:a.GT,value:">",pos:this.pos++};case"!":return n==="="?{type:a.NE,value:"!=",pos:(this.pos+=2)-2}:{type:a.NOT,value:"!",pos:this.pos++};case"(":return{type:a.LPAREN,value:"(",pos:this.pos++};case")":return{type:a.RPAREN,value:")",pos:this.pos++};case"[":return{type:a.LBRACKET,value:"[",pos:this.pos++};case"]":return{type:a.RBRACKET,value:"]",pos:this.pos++};case"{":return{type:a.LBRACE,value:"{",pos:this.pos++};case"}":return{type:a.RBRACE,value:"}",pos:this.pos++};case".":return{type:a.DOT,value:".",pos:this.pos++};case",":return{type:a.COMMA,value:",",pos:this.pos++};case":":return{type:a.COLON,value:":",pos:this.pos++};case"?":return{type:a.QUESTION,value:"?",pos:this.pos++};case'"':case"'":return this.readString();case"b":case"B":case"r":case"R":return n==='"'||n==="'"?(this.pos++,this.readString(e.toLowerCase())):this.readIdentifier();default:{if(e>="0"&&e<="9")return this.readNumber();if(oe[e.charCodeAt(0)])return this.readIdentifier()}}throw new y(`Unexpected character: ${e}`,{pos:this.pos,input:this.input})}_parseAsBigInt(e,n,r,s){let i=this.input.substring(e,n);if(s==="u"||s==="U"){this.pos++;try{return{type:a.NUMBER,value:new $(i),pos:e}}catch{}}else try{return{type:a.NUMBER,value:BigInt(i),pos:e}}catch{}throw new y(r?`Invalid hex integer: ${i}`:`Invalid integer: ${i}`,{pos:e,input:this.input})}readNumber(){let{input:e,length:n,pos:r}=this;if(e[r]==="0"&&(e[r+1]==="x"||e[r+1]==="X")){for(this.pos+=2;this.pos<n&&xe[e[this.pos].charCodeAt(0)];)this.pos++;return this._parseAsBigInt(r,this.pos,!0,e[this.pos])}let s;for(;this.pos<n&&(s=e[this.pos])>="0"&&s<="9";)this.pos++;if(s==="."&&(s=e[this.pos+1])>="0"&&s<="9"){for(this.pos++;this.pos<n&&(s=e[this.pos])>="0"&&s<="9";)this.pos++;let i=e.substring(r,this.pos),o=Number(i);if(Number.isFinite(o))return{type:a.NUMBER,value:o,pos:r};throw new y(`Invalid number: ${o}`,{pos:r,input:this.input})}return this._parseAsBigInt(r,this.pos,!1,e[this.pos])}readString(e){let n=this.input[this.pos++];return this.input[this.pos]===n&&this.input[this.pos+1]===n?(this.pos+=2,this.readTripleQuotedString(n,e)):this.readSingleQuotedString(n,e)}_closeQuotedString(e,n){if(n==="b"){let s=this.processEscapes(e,!0),i=new Uint8Array(s.length);for(let o=0;o<s.length;o++)i[o]=s.charCodeAt(o)&255;return{type:a.BYTES,value:i,pos:this.pos-e.length-2}}let r=n==="r"?e:this.processEscapes(e,!1);return{type:a.STRING,value:r,pos:this.pos-e.length}}readSingleQuotedString(e,n){let{input:r,length:s,pos:i}=this,o=n!=="r";for(;this.pos<s;){let c=r[this.pos];if(c===e){let h=r.slice(i,this.pos);return this.pos++,this._closeQuotedString(h,n)}if(c===`
`||c==="\r")throw new y("Newlines not allowed in single-quoted strings",{pos:i-1,input:r});if(c==="\\"&&o){if(this.pos+=2,this.pos>s)throw new y("Unterminated escape sequence",{pos:i-1,input:r});continue}this.pos++}throw new y("Unterminated string",{pos:i-1,input:r})}readTripleQuotedString(e,n){let r=this.pos,s=n!=="r";for(;this.pos<this.length;){let i=this.input[this.pos];if(i===e&&this.input[this.pos+1]===e&&this.input[this.pos+2]===e){let o=this.input.slice(r,this.pos);return this.pos+=3,this._closeQuotedString(o,n)}if(i==="\\"&&s){if(this.pos+=2,this.pos>this.length)throw new y("Unterminated escape sequence",{pos:r-3,input:this.input});continue}this.pos++}throw new y("Unterminated triple-quoted string",{pos:r-3,input:this.input})}processEscapes(e,n){let r="",s=0;for(;s<e.length;){if(e[s]!=="\\"||s+1>=e.length){r+=e[s++];continue}let i=e[s+1];if(ke[i])r+=ke[i],s+=2;else if(i==="u"){if(n)throw new y("\\u not allowed in bytes literals");let o=e.substring(s+2,s+6);if(o.length!==4||!/^[0-9a-fA-F]{4}$/.test(o))throw new y(`Invalid Unicode escape: \\u${o}`);let c=Number.parseInt(o,16);if(c>=55296&&c<=57343)throw new y(`Invalid Unicode surrogate: \\u${o}`);r+=String.fromCharCode(c),s+=6}else if(i==="U"){if(n)throw new y("\\U not allowed in bytes literals");let o=e.substring(s+2,s+10);if(o.length!==8||!/^[0-9a-fA-F]{8}$/.test(o))throw new y(`Invalid Unicode escape: \\U${o}`);let c=Number.parseInt(o,16);if(c>1114111)throw new y(`Invalid Unicode escape: \\U${o}`);if(c>=55296&&c<=57343)throw new y(`Invalid Unicode surrogate: \\U${o}`);r+=String.fromCodePoint(c),s+=10}else if(i==="x"||i==="X"){let o=e.substring(s+2,s+4);if(o.length!==2||!/^[0-9a-fA-F]{2}$/.test(o))throw new y(`Invalid hex escape: \\${i}${o}`);r+=String.fromCharCode(Number.parseInt(o,16)),s+=4}else if(i>="0"&&i<="7"){let o=e.substring(s+1,s+4);if(o.length!==3||!/^[0-7]{3}$/.test(o))throw new y("Octal escape must be 3 digits");let c=Number.parseInt(o,8);if(c>255)throw new y(`Octal escape out of range: \\${o}`);r+=String.fromCharCode(c),s+=4}else throw new y(`Invalid escape sequence: \\${i}`)}return r}readIdentifier(){let e=this.pos;for(;this.pos<this.length&&oe[this.input[this.pos].charCodeAt(0)];)this.pos++;let n=this.input.substring(e,this.pos);switch(n){case"true":return{type:a.BOOLEAN,value:!0,pos:e};case"false":return{type:a.BOOLEAN,value:!1,pos:e};case"null":return{type:a.NULL,value:null,pos:e};case"in":return{type:a.IN,value:"in",pos:e};default:return{type:a.IDENTIFIER,value:n,pos:e}}}},D=class{constructor(e){this.input=e,this.lexer=new ae(e),this.currentToken=this.lexer.nextToken()}consume(e){let n=this.currentToken;if(this.currentToken=this.lexer.nextToken(),n.type===e)return n;throw new y(`Expected ${J[e]}, got ${J[n.type]}`,{pos:n.pos,input:this.input})}match(e){return this.currentToken.type===e}parse(){let e=this.parseExpression();if(!this.match(a.EOF))throw new y(`Unexpected character: '${this.input[this.lexer.pos-1]}'`,{pos:this.currentToken.pos,input:this.input});return e}parseExpression(){let e=this.parseLogicalOr();if(this.match(a.QUESTION)){let n=this.consume(a.QUESTION),r=this.parseExpression();return this.consume(a.COLON),new f(n.pos,this.input,["?:",e,r,this.parseExpression()])}return e}parseLogicalOr(){let e=this.parseLogicalAnd();for(;this.match(a.OR);){let n=this.consume(a.OR);e=new f(n.pos,this.input,[n.value,e,this.parseLogicalAnd()])}return e}parseLogicalAnd(){let e=this.parseEquality();for(;this.match(a.AND);){let n=this.consume(a.AND);e=new f(n.pos,this.input,[n.value,e,this.parseEquality()])}return e}parseEquality(){let e=this.parseRelational();for(;this.match(a.EQ)||this.match(a.NE);){let n=this.currentToken;this.currentToken=this.lexer.nextToken(),e=new f(n.pos,this.input,[n.value,e,this.parseRelational()])}return e}parseRelational(){let e=this.parseAdditive();for(;this.match(a.LT)||this.match(a.LE)||this.match(a.GT)||this.match(a.GE)||this.match(a.IN);){let n=this.currentToken;this.currentToken=this.lexer.nextToken(),e=new f(n.pos,this.input,[n.value,e,this.parseAdditive()])}return e}parseAdditive(){let e=this.parseMultiplicative();for(;this.match(a.PLUS)||this.match(a.MINUS);){let n=this.currentToken;this.currentToken=this.lexer.nextToken(),e=new f(n.pos,this.input,[n.value,e,this.parseMultiplicative()])}return e}parseMultiplicative(){let e=this.parseUnary();for(;this.match(a.MULTIPLY)||this.match(a.DIVIDE)||this.match(a.MODULO);){let n=this.currentToken;this.currentToken=this.lexer.nextToken(),e=new f(n.pos,this.input,[n.value,e,this.parseUnary()])}return e}parseUnary(){let e=this.currentToken;return e.type===a.NOT?(this.currentToken=this.lexer.nextToken(),new f(e.pos,this.input,["!_",this.parseUnary()])):e.type===a.MINUS?(this.currentToken=this.lexer.nextToken(),new f(e.pos,this.input,["-_",this.parseUnary()])):this.parsePostfix()}assertReservedIdentifier(e){if(We.has(e.value))throw new y(`Reserved identifier: ${e.value}`,{pos:e.pos,input:this.input})}parsePostfix(){let e=this.parsePrimary();for(;;)if(this.match(a.DOT)){this.consume(a.DOT);let n=this.consume(a.IDENTIFIER);if(this.match(a.LPAREN)){this.consume(a.LPAREN);let r=this.parseArgumentList();this.consume(a.RPAREN),e=new f(n.pos,this.input,["rcall",n.value,e,r])}else e=new f(n.pos,this.input,[".",e,n.value])}else if(this.match(a.LBRACKET)){let n=this.consume(a.LBRACKET),r=this.parseExpression();this.consume(a.RBRACKET),e=new f(n.pos,this.input,["[]",e,r])}else break;return e}parsePrimary(){switch(this.currentToken.type){case a.NUMBER:{let e=this.consume(a.NUMBER);return new f(e.pos,this.input,["value",e.value])}case a.STRING:{let e=this.consume(a.STRING);return new f(e.pos,this.input,["value",e.value])}case a.BYTES:{let e=this.consume(a.BYTES);return new f(e.pos,this.input,["value",e.value])}case a.BOOLEAN:{let e=this.consume(a.BOOLEAN);return new f(e.pos,this.input,["value",e.value])}case a.NULL:{let e=this.consume(a.NULL);return new f(e.pos,this.input,["value",e.value])}case a.IDENTIFIER:{let e=this.consume(a.IDENTIFIER);if(this.assertReservedIdentifier(e),this.match(a.LPAREN)){this.consume(a.LPAREN);let n=this.parseArgumentList();return this.consume(a.RPAREN),new f(e.pos,this.input,["call",e.value,n])}return new f(e.pos,this.input,["id",e.value])}case a.LPAREN:{this.consume(a.LPAREN);let e=this.parseExpression();return this.consume(a.RPAREN),e}case a.LBRACKET:return this.parseList();case a.LBRACE:return this.parseMap()}throw new y(`Unexpected token: ${J[this.currentToken.type]}`,{pos:this.currentToken.pos,input:this.input})}parseList(){let e=this.consume(a.LBRACKET),n=[];if(!this.match(a.RBRACKET))for(n.push(this.parseExpression());this.match(a.COMMA);)this.consume(a.COMMA),this.match(a.RBRACKET)||n.push(this.parseExpression());return this.consume(a.RBRACKET),new f(e.pos,this.input,["list",n])}parseMap(){let e=this.consume(a.LBRACE),n=[];if(!this.match(a.RBRACE))for(n.push(this.parseProperty());this.match(a.COMMA);)this.consume(a.COMMA),this.match(a.RBRACE)||n.push(this.parseProperty());return this.consume(a.RBRACE),new f(e.pos,this.input,["map",n])}parseProperty(){let e=this.parseExpression();this.consume(a.COLON);let n=this.parseExpression();return[e,n]}parseArgumentList(){let e=[];if(!this.match(a.RPAREN))for(e.push(this.parseExpression());this.match(a.COMMA);)this.consume(a.COMMA),this.match(a.RPAREN)||e.push(this.parseExpression());return e}};var u=(t,e)=>R.registerFunctionOverload(t,e);u("has(ast): bool",function(t){let e=t[2][0];if(e[0]===".")return Oe(this,e,t)!==void 0;throw new l("has() invalid argument",t)});function Oe(t,e,n){switch(e[0]){case"id":return t.eval(e);case".":{let r=Oe(t,e[1],n);if(!r)throw new l(`No such key: ${e[2]}`,e);return t.debugType(r).fieldLazy(r,e[2],n,t)}}throw new l("has() invalid argument",n)}u("dyn(dyn): dyn",t=>t);for(let t in O){let e=O[t];e instanceof w&&u(`type(${e.name}): type`,()=>e)}u("bool(bool): bool",t=>t);u("bool(string): bool",t=>{switch(t){case"1":case"t":case"true":case"TRUE":case"True":return!0;case"0":case"f":case"false":case"FALSE":case"False":return!1;default:throw new l(`bool() conversion error: invalid string value "${t}"`)}});var Ie=Object.keys;u("size(string): int",t=>BigInt(Ue(t)));u("size(bytes): int",t=>BigInt(t.length));u("size(list): int",t=>BigInt(t.length??t.size));u("size(map): int",t=>BigInt(t instanceof Map?t.size:Ie(t).length));u("string.size(): int",t=>BigInt(Ue(t)));u("bytes.size(): int",t=>BigInt(t.length));u("list.size(): int",t=>BigInt(t.length??t.size));u("map.size(): int",t=>BigInt(t instanceof Map?t.size:Ie(t).length));u("bytes(string): bytes",t=>L.fromString(t));u("bytes(bytes): bytes",t=>t);u("double(double): double",t=>t);u("double(int): double",t=>Number(t));u("double(string): double",t=>{if(!t||t!==t.trim())throw new l("double() type error: cannot convert to double");switch(t.toLowerCase()){case"inf":case"+inf":case"infinity":case"+infinity":return Number.POSITIVE_INFINITY;case"-inf":case"-infinity":return Number.NEGATIVE_INFINITY;case"nan":return Number.NaN;default:{let n=Number(t);if(!Number.isNaN(n))return n;throw new l("double() type error: cannot convert to double")}}});u("int(int): int",t=>t);u("int(double): int",t=>{if(Number.isFinite(t))return BigInt(Math.trunc(t));throw new l("int() type error: integer overflow")});u("int(string): int",t=>{if(t!==t.trim()||t.length>20||t.includes("0x"))throw new l("int() type error: cannot convert to int");try{let e=BigInt(t);if(e<=9223372036854775807n&&e>=-9223372036854775808n)return e}catch{}throw new l("int() type error: cannot convert to int")});u("uint(uint): uint",t=>t);u("uint(double): uint",t=>{if(Number.isFinite(t))return BigInt(Math.trunc(t));throw new l("int() type error: integer overflow")});u("uint(string): uint",t=>{if(t!==t.trim()||t.length>20||t.includes("0x"))throw new l("uint() type error: cannot convert to uint");try{let e=BigInt(t);if(e<=18446744073709551615n&&e>=0n)return e}catch{}throw new l("uint() type error: cannot convert to uint")});u("string(string): string",t=>t);u("string(bool): string",t=>`${t}`);u("string(int): string",t=>`${t}`);u("string(bytes): string",t=>L.toUtf8(t));u("string(double): string",t=>t===1/0?"+Inf":t===-1/0?"-Inf":`${t}`);u("string.startsWith(string): bool",(t,e)=>t.startsWith(e));u("string.endsWith(string): bool",(t,e)=>t.endsWith(e));u("string.contains(string): bool",(t,e)=>t.includes(e));u("string.indexOf(string): bool",(t,e)=>BigInt(t.indexOf(e)));u("string.indexOf(string, int): bool",(t,e,n)=>{if(e==="")return n;if(n=Number(n),n<0||n>=t.length)throw new l("string.indexOf(search, fromIndex): fromIndex out of range");return BigInt(t.indexOf(e,n))});u("string.lastIndexOf(string): bool",(t,e)=>BigInt(t.lastIndexOf(e)));u("string.lastIndexOf(string, int): bool",(t,e,n)=>{if(e==="")return n;if(n=Number(n),n<0||n>=t.length)throw new l("string.lastIndexOf(search, fromIndex): fromIndex out of range");return BigInt(t.lastIndexOf(e,n))});u("string.substring(int): string",(t,e)=>{if(e=Number(e),e<0||e>t.length)throw new l("string.substring(start, end): start index out of range");return t.substring(e)});u("string.substring(int, int): string",(t,e,n)=>{if(e=Number(e),e<0||e>t.length)throw new l("string.substring(start, end): start index out of range");if(n=Number(n),n<e||n>t.length)throw new l("string.substring(start, end): end index out of range");return t.substring(e,n)});u("string.matches(string): bool",(t,e)=>{try{return new RegExp(e).test(t)}catch{throw new l(`Invalid regular expression: ${e}`)}});u("string.split(string): list",(t,e)=>t.split(e));u("string.split(string, int): list",(t,e,n)=>t.split(e,n));u("list.join(): string",t=>{for(let e=0;e<t.length;e++)if(typeof t[e]!="string")throw new l("string.join(): list must contain only strings");return t.join("")});u("list.join(string): string",(t,e)=>{for(let n=0;n<t.length;n++)if(typeof t[n]!="string")throw new l("string.join(separator): list must contain only strings");return t.join(e)});var ce=new TextEncoder("utf8"),Je=new TextDecoder("utf8"),L=typeof Buffer<"u"?{byteLength:t=>Buffer.byteLength(t),fromString:t=>Buffer.from(t,"utf8"),toHex:t=>Buffer.prototype.hexSlice.call(t,0,t.length),toBase64:t=>Buffer.prototype.base64Slice.call(t,0,t.length),toUtf8:t=>Buffer.prototype.utf8Slice.call(t,0,t.length),jsonParse:t=>JSON.parse(t)}:{textEncoder:new TextEncoder("utf8"),byteLength:t=>ce.encode(t).length,fromString:t=>ce.encode(t),toHex:Uint8Array.prototype.toHex?t=>t.toHex():t=>Array.from(t,e=>e.toString(16).padStart(2,"0")).join(""),toBase64:Uint8Array.prototype.toBase64?t=>t.toBase64():t=>btoa(Array.from(t,e=>String.fromCodePoint(e)).join("")),toUtf8:t=>Je.decode(t),jsonParse:t=>JSON.parse(ce.decode(t))};u("bytes.json(): map",L.jsonParse);u("bytes.hex(): string",L.toHex);u("bytes.string(): string",L.toUtf8);u("bytes.base64(): string",L.toBase64);u("bytes.at(int): int",(t,e)=>{if(e<0||e>=t.length)throw new l("Bytes index out of range");return BigInt(t[e])});var m="google.protobuf.Timestamp";function C(t,e){return new Date(t.toLocaleString("en-US",{timeZone:e}))}function Ce(t,e){let n=e?C(t,e):new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()),r=new Date(n.getFullYear(),0,0);return BigInt(Math.floor((n-r)/864e5)-1)}u(`timestamp(string): ${m}`,t=>{if(t.length<20||t.length>30)throw new l("timestamp() requires a string in ISO 8601 format");let e=new Date(t);if(e<=0xe677d21fdbff&&e>=-621355968e5)return e;throw new l("timestamp() requires a string in ISO 8601 format")});u(`timestamp(int): ${m}`,t=>{if(t=Number(t)*1e3,t<=0xe677d21fdbff&&t>=-621355968e5)return new Date(t);throw new l("timestamp() requires a valid integer unix timestamp")});u(`${m}.getDate(): int`,t=>BigInt(t.getUTCDate()));u(`${m}.getDate(string): int`,(t,e)=>BigInt(C(t,e).getDate()));u(`${m}.getDayOfMonth(): int`,t=>BigInt(t.getUTCDate()-1));u(`${m}.getDayOfMonth(string): int`,(t,e)=>BigInt(C(t,e).getDate()-1));u(`${m}.getDayOfWeek(): int`,t=>BigInt(t.getUTCDay()));u(`${m}.getDayOfWeek(string): int`,(t,e)=>BigInt(C(t,e).getDay()));u(`${m}.getDayOfYear(): int`,Ce);u(`${m}.getDayOfYear(string): int`,Ce);u(`${m}.getFullYear(): int`,t=>BigInt(t.getUTCFullYear()));u(`${m}.getFullYear(string): int`,(t,e)=>BigInt(C(t,e).getFullYear()));u(`${m}.getHours(): int`,t=>BigInt(t.getUTCHours()));u(`${m}.getHours(string): int`,(t,e)=>BigInt(C(t,e).getHours()));u(`${m}.getMilliseconds(): int`,t=>BigInt(t.getUTCMilliseconds()));u(`${m}.getMilliseconds(string): int`,t=>BigInt(t.getUTCMilliseconds()));u(`${m}.getMinutes(): int`,t=>BigInt(t.getUTCMinutes()));u(`${m}.getMinutes(string): int`,(t,e)=>BigInt(C(t,e).getMinutes()));u(`${m}.getMonth(): int`,t=>BigInt(t.getUTCMonth()));u(`${m}.getMonth(string): int`,(t,e)=>BigInt(C(t,e).getMonth()));u(`${m}.getSeconds(): int`,t=>BigInt(t.getUTCSeconds()));u(`${m}.getSeconds(string): int`,(t,e)=>BigInt(C(t,e).getSeconds()));var $=class{#e;constructor(e){this.verify(BigInt(e))}get value(){return this.#e}valueOf(){return this.#e}verify(e){if(e<0n||e>18446744073709551615n)throw new l("Unsigned integer overflow");this.#e=e}get[Symbol.toStringTag](){return`value = ${this.#e}`}[Symbol.for("nodejs.util.inspect.custom")](){return`UnsignedInteger { value: ${this.#e} }`}},Xe={h:3600000000000n,m:60000000000n,s:1000000000n,ms:1000000n,us:1000n,\u00B5s:1000n,ns:1n},U=class t{#e;#t;constructor(e,n=0){this.#e=BigInt(e),this.#t=n}get seconds(){return this.#e}get nanos(){return this.#t}valueOf(){return Number(this.#e)*1e3+this.#t/1e6}addDuration(e){let n=this.#t+e.nanos;return new t(this.#e+e.seconds+BigInt(Math.floor(n/1e9)),n%1e9)}subtractDuration(e){let n=this.#t-e.nanos;return new t(this.#e-e.seconds+BigInt(Math.floor(n/1e9)),(n+1e9)%1e9)}extendTimestamp(e){return new Date(e.getTime()+Number(this.#e)*1e3+Math.floor(this.#t/1e6))}subtractTimestamp(e){return new Date(e.getTime()-Number(this.#e)*1e3-Math.floor(this.#t/1e6))}toString(){let e=this.#t?(this.#t/1e9).toLocaleString("en-US",{useGrouping:!1,maximumFractionDigits:9}).slice(1):"";return`${this.#e}${e}s`}getHours(){return this.#e/3600n}getMinutes(){return this.#e/60n}getSeconds(){return this.#e}getMilliseconds(){return this.#e*1000n+BigInt(Math.floor(this.#t/1e6))}get[Symbol.toStringTag](){return"google.protobuf.Duration"}[Symbol.for("nodejs.util.inspect.custom")](){return`google.protobuf.Duration { seconds: ${this.#e}, nanos: ${this.#t} }`}},Ze=/(\d*\.?\d*)(ns|us|Âµs|ms|s|m|h)/;function et(t){if(!t)throw new l("Invalid duration string: ''");let e=t[0]==="-";(t[0]==="-"||t[0]==="+")&&(t=t.slice(1));let n=BigInt(0);for(;;){let i=Ze.exec(t);if(!i)throw new l(`Invalid duration string: ${t}`);if(i.index!==0)throw new l(`Invalid duration string: ${t}`);t=t.slice(i[0].length);let o=Xe[i[2]],[c="0",h=""]=i[1].split("."),g=BigInt(c)*o,T=h?BigInt(h.slice(0,13).padEnd(13,"0"))*o/10000000000000n:0n;if(n+=g+T,t==="")break}let r=n>=1000000000n?n/1000000000n:0n,s=Number(n%1000000000n);return e?new U(-r,-s):new U(r,s)}u("duration(string): google.protobuf.Duration",t=>et(t));u("google.protobuf.Duration.getHours(): int",t=>t.getHours());u("google.protobuf.Duration.getMinutes(): int",t=>t.getMinutes());u("google.protobuf.Duration.getSeconds(): int",t=>t.getSeconds());u("google.protobuf.Duration.getMilliseconds(): int",t=>t.getMilliseconds());function ue(t,e){return t.type==="list"?t.valueType:t.type==="map"?t.keyType:e.getType("dyn")}function le(t,e){let n=t[0];if(n instanceof f&&n[0]==="id")return n[1];throw new d(`${e} requires first argument to be an identifier`,n)}function he(t,e,n,r){let s=t.variables.get(e);t.variables.set(e,n);try{return r()}finally{s!==void 0?t.variables.set(e,s):t.variables.delete(e)}}function j(t){return(e,n,r)=>{let s=le(r,`${t}(var, predicate)`),i=ue(n,e);return he(e,s,i,()=>{let o=e.check(r[1]);if(o.isDynOrBool())return o;throw new d(`predicate must return bool, got '${o}'`,r[1])})}}function X(t,e,n){let r=`map(var, ${n.length===3?"filter, ":""}transform)`,s=le(n,r),i=ue(e,t);return he(t,s,i,()=>{if(n.length===3){let c=t.check(n[1]);if(!c.isDynOrBool())throw new d(`${r} filter predicate must return bool, got '${c}'`,n[1])}let o=t.check(n[n.length-1]);return t.getType(`list<${o}>`)})}function Be(t,e,n){let r="filter(var, filter)",s=le(n,r),i=ue(e,t);return he(t,s,i,()=>{let o=t.check(n[1]);if(o.isDynOrBool())return t.getType(`list<${i}>`);throw new d(`${r} predicate must return bool, got '${o}'`,n[1])})}u("list.all(ast, ast): bool",{handler:Ne,typeCheck:j("all")});u("map.all(ast, ast): bool",{handler:Ne,typeCheck:j("all")});u("list.exists(ast, ast): bool",{handler:Ae,typeCheck:j("exists")});u("map.exists(ast, ast): bool",{handler:Ae,typeCheck:j("exists")});u("list.exists_one(ast, ast): bool",{handler:Me,typeCheck:j("exists_one")});u("map.exists_one(ast, ast): bool",{handler:Me,typeCheck:j("exists_one")});u("list.map(ast, ast): list",{handler:Re,typeCheck:X});u("list.map(ast, ast, ast): list",{handler:Se,typeCheck:X});u("map.map(ast, ast): list",{handler:Re,typeCheck:X});u("map.map(ast, ast, ast): list",{handler:Se,typeCheck:X});u("list.filter(ast, ast): list",{handler:De,typeCheck:Be});u("map.filter(ast, ast): list",{handler:De,typeCheck:Be});var _=Symbol("predicateEvaluator");function Ne(t,e){let n=e[_]??=this.predicateEvaluator("all(var, predicate)",e),r=n.prepare(this,t),s=null;for(let i=0;i<r.length;i++)try{if(n.childEvaluateBool(r[i]))continue;return!1}catch(o){if(o.message.includes("Unknown variable")||o.message.includes("predicate result is not a boolean"))throw o;s??=o}if(s)throw s;return!0}function Ae(t,e){let n=e[_]??=this.predicateEvaluator("exists(var, predicate)",e),r=n.prepare(this,t),s;for(let i=0;i<r.length;i++)try{if(n.childEvaluateBool(r[i]))return!0}catch(o){if(o.message.includes("Unknown variable")||o.message.includes("predicate result is not a boolean"))throw o;s??=o}if(s)throw s;return!1}function Me(t,e){let n=e[_]??=this.predicateEvaluator("exists_one(var, predicate)",e),r=n.prepare(this,t),s=0;for(let i=0;i<r.length;i++)if(n.childEvaluateBool(r[i])!==!1&&++s>1)return!1;return s===1}function Re(t,e){let n=e[_]??=this.predicateEvaluator("map(var, transform)",e),r=n.prepare(this,t),s=[];for(let i=0;i<r.length;i++)s[i]=n.childEvaluate(r[i]);return s}function Se(t,e){let n=e[_]??=this.predicateEvaluator("map(var, filter, transform)",e),r=e[3][2],s=n.prepare(this,t),i=[];for(let o=0;o<s.length;o++)switch(n.childEvaluateBool(s[o])){case!1:continue;case!0:i.push(n.eval(r));continue}return i}function De(t,e){let n=e[_]??=this.predicateEvaluator("filter(var, predicate)",e),r=n.prepare(this,t),s=[];for(let i=0;i<r.length;i++){let o=r[i];n.childEvaluateBool(o)!==!1&&s.push(o)}return s}function Ue(t){let e=0;for(let n of t)e++;return e}var pe=(...t)=>R.unaryOverload(...t),p=(...t)=>R.binaryOverload(...t);function fe(t,e){if(t<=9223372036854775807n&&t>=-9223372036854775808n)return t;throw new l(`integer overflow: ${t}`,e)}pe("!","bool",t=>!t);pe("-","int",t=>-t);p("int","*","int",(t,e,n)=>fe(t*e,n));p("int","+","int",(t,e,n)=>fe(t+e,n));p("int","-","int",(t,e,n)=>fe(t-e,n));p("int","/","int",(t,e,n)=>{if(e===0n)throw new l("division by zero",n);return t/e});p("int","%","int",(t,e,n)=>{if(e===0n)throw new l("modulo by zero",n);return t%e});pe("-","double",t=>-t);p("double","*","double",(t,e)=>t*e);p("double","+","double",(t,e)=>t+e);p("double","-","double",(t,e)=>t-e);p("double","/","double",(t,e,n)=>{if(e===0)throw new l("division by zero",n);return t/e});p("string","+","string",(t,e)=>t+e);p("list","+","list",(t,e)=>[...t,...e]);p("bytes","+","bytes",(t,e)=>{let n=new Uint8Array(t.length+e.length);return n.set(t,0),n.set(e,t.length),n});var B="google.protobuf.Duration";p(B,"+",B,(t,e)=>t.addDuration(e));p(B,"-",B,(t,e)=>t.subtractDuration(e));p(B,"==",B,(t,e)=>t.seconds===e.seconds&&t.nanos===e.nanos);var q="google.protobuf.Timestamp";p(q,"==",q,(t,e)=>t.getTime()===e.getTime());p(q,"-",B,(t,e)=>e.subtractTimestamp(t));p(q,"+",B,(t,e)=>e.extendTimestamp(t));p(B,"+",q,(t,e)=>t.extendTimestamp(e));function tt(t,e,n,r){if(e instanceof Set&&e.has(t))return!0;for(let s of e)if(H(t,s,r))return!0;return!1}function nt(t,e){return Array.isArray(e)?e.includes(t):e.has(t)}for(let t of["string","bool","null"])p(t,"in","list",nt);for(let t of["int","double","list","map"])p(t,"in","list",tt);for(let t of["string","int","double","bool","null"])p(t,"in","map",(e,n)=>n instanceof Map?n.get(e)!==void 0:Object.hasOwn(n,e)?n[e]!==void 0:!1);for(let t of["string","int","double","bool","null","bytes","map","list","google.protobuf.Duration","google.protobuf.Timestamp"])p(t,"==","dyn",()=>!1);for(let t of["type","null","bool","string","int","double"])p(t,"==",t,(e,n)=>e===n);p("int","==","dyn<double>",(t,e)=>t==e);p("int","==","dyn<uint>",(t,e)=>t==e.valueOf());p("uint","==","dyn<double>",(t,e)=>t.valueOf()==e);p("uint","==","dyn<int>",(t,e)=>t.valueOf()==e);p("double","==","dyn<int>",(t,e)=>t==e);p("double","==","dyn<uint>",(t,e)=>t==e.valueOf());p("bytes","==","bytes",(t,e)=>{let n=t.length;if(n!==e.length)return!1;for(;n--;)if(t[n]!==e[n])return!1;return!0});p("list","==","list",(t,e,n,r)=>{if(Array.isArray(t)&&Array.isArray(e)){let o=t.length;if(o!==e.length)return!1;for(let c=0;c<o;c++)if(!H(t[c],e[c],r))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(let o of t)if(!e.has(o))return!1;return!0}let s=t instanceof Set?e:t,i=t instanceof Set?t:e;if(!Array.isArray(s)||s.length!==i?.size)return!1;for(let o=0;o<s.length;o++)if(!i.has(s[o]))return!1;return!0});p("map","==","map",(t,e,n,r)=>{if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(let[o,c]of t)if(!(e.has(o)&&H(c,e.get(o),r)))return!1;return!0}if(t instanceof Map||e instanceof Map){let o=t instanceof Map?e:t,c=t instanceof Map?t:e,h=Object.keys(o);if(c.size!==h.length)return!1;for(let[g,T]of c)if(!(g in o&&H(T,o[g],r)))return!1;return!0}let s=Object.keys(t),i=Object.keys(e);if(s.length!==i.length)return!1;for(let o=0;o<s.length;o++){let c=s[o];if(!(c in e&&H(t[c],e[c],r)))return!1}return!0});p("uint","+","uint",(t,e)=>new $(t.valueOf()+e.valueOf()));p("uint","-","uint",(t,e)=>new $(t.valueOf()-e.valueOf()));p("uint","*","uint",(t,e)=>new $(t.valueOf()*e.valueOf()));p("uint","/","uint",(t,e,n)=>{if(e.valueOf()===0n)throw new l("division by zero",n);return new $(t.valueOf()/e.valueOf())});p("uint","%","uint",(t,e,n)=>{if(e.valueOf()===0n)throw new l("modulo by zero",n);return new $(t.valueOf()%e.valueOf())});for(let[t,e]of[["int","int"],["uint","uint"],["double","double"],["string","string"],["google.protobuf.Timestamp","google.protobuf.Timestamp"],["google.protobuf.Duration","google.protobuf.Duration"],["int","uint"],["int","double"],["double","int"],["double","uint"],["uint","int"],["uint","double"]])p(t,"<",e,(n,r)=>n<r),p(t,"<=",e,(n,r)=>n<=r),p(t,">",e,(n,r)=>n>r),p(t,">=",e,(n,r)=>n>=r);function H(t,e,n){if(t===e)return!0;switch(typeof t){case"string":return!1;case"bigint":return typeof e=="number"?t==e:!1;case"number":return typeof e=="bigint"?t==e:!1;case"boolean":return!1;case"object":if(typeof e!="object"||t===null||e===null)return!1;let r=n.objectTypesByConstructor.get(t.constructor)?.type,s=n.objectTypesByConstructor.get(e.constructor)?.type;if(!r||r!==s)return!1;let i=n.overloads["=="]?.get(r)?.get(s)?.handler;return i?i(t,e,null,n):!1}throw new l(`Cannot compare values of type ${typeof t}`)}var Z=class{constructor({environment:e,variables:n,objectTypes:r,objectTypesByConstructor:s,registry:i}){this.environment=e,this.variables=n,this.objectTypes=r,this.objectTypesByConstructor=s,this.registry=i}get overloads(){return this.registry.overloads}getType(e){return this.registry.getType(e)}check(e){if(e.checkedType)return e.checkedType;switch(e[0]){case"value":return e.checkedType??=this.inferLiteralType(e[1]);case"id":return e.checkedType??=this.checkVariable(e);case".":case"[]":return e.checkedType??=this.checkAccess(e);case"call":return e.checkedType??=this.checkCall(e);case"rcall":return e.checkedType??=this.checkReceiverCall(e);case"list":return e.checkedType??=this.checkList(e);case"map":return e.checkedType??=this.checkMap(e);case"?:":return e.checkedType??=this.checkTernary(e);case"||":case"&&":return e.checkedType??=this.checkLogicalOp(e);case"!_":case"-_":return e.checkedType??=this.checkUnaryOperator(e);case"==":case"!=":case"<":case"<=":case">":case">=":case"+":case"-":case"*":case"/":case"%":case"in":return e.checkedType??=this.checkBinaryOperator(e);default:throw new d(`Unknown operation: ${e[0]}`,e)}}inferLiteralType(e){switch(typeof e){case"string":return this.getType("string");case"bigint":return this.getType("int");case"number":return this.getType("double");case"boolean":return this.getType("bool");case"object":if(e===null)return this.getType("null");let n=this.objectTypesByConstructor.get(e.constructor)?.type;if(n)return n;throw new d(`Unsupported type: ${e.constructor?.name||typeof e}`);default:throw new d(`Unsupported type: ${typeof e}`)}}checkVariable(e){let n=e[1],r=this.variables.get(n);if(r!==void 0)return r;throw new d(`Unknown variable: ${n}`,e)}checkAccess(e){let n=this.check(e[1]);if(n.kind==="dyn")return n;let s=(e[0]==="[]"?this.check(e[2]):this.getType("string")).type;if(n.kind==="list"){if(s!=="int"&&s!=="dyn")throw new d(`List index must be int, got '${s}'`,e);return n.valueType}if(n.kind==="map")return n.valueType;let i=this.objectTypes.get(n.name);if(i){if(!(s==="string"||s==="dyn"))throw new d(`Cannot index type '${n.name}' with type '${s}'`,e);if(i.fields){let o=e[0]==="."?e[2]:void 0;if(o){let c=i.fields[o];if(c)return c;throw new d(`No such key: ${o}`,e)}}return this.getType("dyn")}throw new d(`Cannot index type '${n}'`,e)}checkCall(e){let n=e[1],r=e[2],s=(e.functionCandidates??=this.registry.getFunctionCandidates(null,n,r.length)).filterByReceiverType(null);if(!s.exists)throw new d(`Function not found: '${n}'`,e);if(s.hasMacro)return this.#e(null,s,r);let i=r.map(this.check,this),o=s.findMatch(i);if(!o)throw new d(`found no matching overload for '${n}(${i.join(", ")})'`,e);return o.returnType}#e(e,n,r){let s=n.functions[0];return s.typeCheck?s.typeCheck(this,e,r):s.returnType}checkReceiverCall(e){let n=e[1],r=e[3],s=this.check(e[2]),i=e.functionCandidates??=this.registry.getFunctionCandidates(s,n,r.length);if(!i.exists)throw new d(`Function not found: '${n}' for value of type '${s}'`,e);if(s.kind==="dyn")return i.returnType||s;let o=i.filterByReceiverType(s);if(o.hasMacro)return this.#e(s,o,r);let c=r.map(this.check,this),h=o.findMatch(c);if(!h)throw new d(`found no matching overload for '${s.type}.${n}(${c.join(", ")})'`,e);return h.returnType}checkList(e){let n=e[1];if(n.length===0)return this.getType("list");let r=this.check(n[0]);return n.every(i=>r===this.check(i))?this.getType(`list<${r}>`):this.getType("list")}checkMap(e){let n=e[1];if(n.length===0)return this.getType("map");let r=this.check(n[0][0]),s=this.check(n[0][1]),i=!0,o=!0;for(let g=1;g<n.length;g++){let[T,N]=n[g];r!==this.check(T)&&(i=!1),s!==this.check(N)&&(o=!1)}let c=i?r:"dyn",h=o?s:"dyn";return this.getType(`map<${c}, ${h}>`)}checkTernary(e){let n=this.check(e[1]);if(!n.isDynOrBool())throw new d(`Ternary condition must be bool, got '${n}'`,e);let r=this.check(e[2]),s=this.check(e[3]);return r===s?r:this.getType("dyn")}checkLogicalOp(e){let n=this.check(e[1]),r=this.check(e[2]);if(!n.isDynOrBool())throw new d(`Logical operator requires bool operands, got '${n}'`,e);if(!r.isDynOrBool())throw new d(`Logical operator requires bool operands, got '${r}'`,e);return this.getType("bool")}checkUnaryOperator(e){let n=e[0],r=this.check(e[1]);if(r.kind==="dyn")return n==="!_"?this.getType("bool"):r;let s=this.overloads[n]?.get(r);if(s)return s.returnType;throw new d(`no such overload: ${n[0]}${r.type}`,e)}checkBinaryOperator(e){let n=this.check(e[1]),r=this.check(e[2]),s=e[0];if(n.kind==="dyn"||r.kind==="dyn")return s==="<"||s==="<="||s===">"||s===">="||s==="=="||s==="!="||s==="in"?this.getType("bool"):this.getType("dyn");let i=this.overloads[s]?.get(n)?.get(r);if(i)return i.returnType;throw new d(`no such overload: ${n} ${e[0]} ${r}`,e)}};var rt=new Map(Object.entries({value(t){return t[1]},id(t,e){let n=t[1],r=e.variables.get(n);if(r===void 0)throw new l(`Unknown variable: ${n}`,t);let s=e.ctx.get(n);if(s===void 0)throw new l(`Unknown variable: ${n}`,t);let i=e.debugType(s);if(r.matches(i))return s;throw new l(`Variable '${n}' is not of type '${r}', got '${i}'`,t)},"||"(t,e){try{let r=e.eval(t[1]);if(r===!0)return!0;if(r!==!1)throw new l("Left operand of || is not a boolean",t[1])}catch(r){if(r.message.includes("Unknown variable")||r.message.includes("is not a boolean"))throw r;let s=e.eval(t[2]);if(s===!0)return!0;throw s===!1?r:new l("Right operand of || is not a boolean",t[2])}let n=e.eval(t[2]);if(typeof n=="boolean")return n;throw new l("Right operand of || is not a boolean",t[2])},"&&"(t,e){try{let r=e.eval(t[1]);if(r===!1)return!1;if(r!==!0)throw new l("Left operand of && is not a boolean",t[1])}catch(r){if(r.message.includes("Unknown variable")||r.message.includes("is not a boolean"))throw r;let s=e.eval(t[2]);if(s===!1)return!1;throw s===!0?r:new l("Right operand of && is not a boolean",t[2])}let n=e.eval(t[2]);if(typeof n=="boolean")return n;throw new l("Right operand of && is not a boolean",t[2])},"."(t,e){let n=e.eval(t[1]);return e.debugType(n).field(n,t[2],t,e)},"[]"(t,e){let n=e.eval(t[1]);return e.debugType(n).field(n,e.eval(t[2]),t,e)},rcall(t,e){let n=t[1],r=e.eval(t[2]),s=t[3],i=t.functionCandidates??=e.registry.getFunctionCandidates(e.tryCheck(t[2])||e.celTypes.dyn,n,s.length),o=e.debugType(r);if(!i.exists)throw new l(`Function not found: '${n}' for value of type '${o}'`,t);let c=i.filterByReceiverType(o),h;c.hasMacro?h=t.macroArgTypes??=s.map(()=>e.registry.getFunctionType("ast")):(s=s.map(e.eval,e),h=s.map(e.debugType,e));let g=c.findMatch(h);if(!g)throw new l(`found no matching overload for '${o.type}.${n}(${h.join(", ")})'`,t);try{return g.macro?g.handler.call(e,r,t):g.handler.call(e,r,...s)}catch(T){throw T instanceof l?T.withAst(t):T}},call(t,e){let n=t[1],r=t[2],s=t.functionCandidates??=e.registry.getFunctionCandidates(null,n,r.length);if(s.exists===!1)throw new l(`Function not found: '${n}'`,t);let i=s.filterByReceiverType(null),o;s.hasMacro?o=t.macroArgTypes??=r.map(()=>e.registry.getFunctionType("ast")):(r=r.map(e.eval,e),o=r.map(e.debugType,e));let c=i.findMatch(o);if(!c)throw new l(`found no matching overload for '${n}(${o.join(", ")})'`,t);try{return c.macro?c.handler.call(e,t):c.handler.apply(e,r)}catch(h){throw h instanceof l?h.withAst(t):h}},list(t,e){let n=t[1],r=new Array(n.length);for(let s=0;s<n.length;s++)r[s]=e.eval(n[s]);return r},map(t,e){let n={},r=t[1];for(let s=0;s<r.length;s++){let i=r[s];n[e.eval(i[0])]=e.eval(i[1])}return n},"?:"(t,e){let n=e.eval(t[1]);if(n===!0)return e.eval(t[2]);if(n===!1)return e.eval(t[3]);throw new l("Ternary condition must be a boolean")},"!_":Le,"-_":Le,"!=":E,"==":E,in:E,"+":E,"-":E,"*":E,"/":E,"%":E,"<":E,"<=":E,">":E,">=":E}));function Le(t,e){let n=e.eval(t[1]),r=e.debugType(n),s=e.getUnaryOverload(t[0],r);if(s)return s.handler(n);throw new l(`no such overload: ${t[0][0]}${r}`,t)}var je=Symbol("astCache");function st(t,e,n,r){if(!(t.isDynamic(e[1])||t.isDynamic(e[2])))return;let s=(e[je]??=new Map).get(n)||e[je].set(n,new Map).get(n),i=s.get(r);if(i!==void 0)return i;let o=it(t,e,n,r);return s.set(r,o),o}function it(t,e,n,r){let s=t.overloads[e[0]],i=t.isDynamic(e[1]),o=t.isDynamic(e[2]),c=i&&t.registry.getVerifiedType(`dyn<${n.type}>`),h=o&&t.registry.getVerifiedType(`dyn<${r.type}>`);return c&&h&&s.get(c)?.get(h)||c&&s.get(c)?.get(r)||h&&s.get(n)?.get(h)||i&&s.get(t.celTypes.dyn)?.get(r)||o&&s.get(n)?.get(t.celTypes.dyn)||i&&o&&s.get(t.celTypes.dyn)?.get(t.celTypes.dyn)||!1}function E(t,e){let n=e.eval(t[1]),r=e.eval(t[2]),s=e.debugType(n),i=e.debugType(r),o=e.overloads[t[0]]?.get(s)?.get(i)||st(e,t,s,i);if(o)return o.handler(n,r,t,e);throw new l(`no such overload: ${s} ${t[0]} ${i}`,t)}var Fe=[[void 0,"map"],[Object,"map"],[Map,"map"],[Array,"list"],[Uint8Array,"bytes"],[Date,"google.protobuf.Timestamp"],[U,"google.protobuf.Duration"],[$,"uint"],[w,"type"]];typeof Buffer<"u"&&Fe.push([Buffer,"bytes"]);var ge=class extends Map{get(e){return super.get(e)||G.dyn}},ee=class{},ye=class extends ee{#e;#t;constructor(e){super(),this.#t=e}setPrimaryContext(e){if(this.#e=e,!e)return this.get=this.#r;if(typeof e!="object")throw new l("Context must be an object");e instanceof Map?this.get=this.#n:this.get=this.#i}get(){throw new l("Context not initialized")}#r(e){return this.#t.get(e)}#i(e){let n=Object.hasOwn(this.#e,e)?this.#e[e]:void 0;return n!==void 0?n:this.#t?.get(e)}#n(e){let n=this.#e.get(e);return n!==void 0?n:this.#t?.get(e)}},de=class extends ee{#e;#t;#r;constructor(e){super(),this.#t=e}setContext(e){this.#e=e}setOverride(e){this.#r=e}get(e){return e===this.#t?this.#r:this.#e.get(e)}},me=class{#e;#t;#r;constructor(e,n,r){this.#e=e,this.#t=n,this.#r=r}get(e){return e===this.#t?this.#r:this.#e.get(e)}},K=class{#e;#t;#r;#i;#n;#o;#s;constructor(e){e?.unlistedVariablesAreDyn?this.#e=new ge:this.#e=new Map,this.#n=R.clone(),this.#t=this.#n.objectTypes,this.#r=this.#n.objectTypesByConstructor,this.#i=this.#n.functions;for(let[r,s]of Fe)this.#n.registerType(s,r,!0);let n={environment:this,variables:this.#e,functions:this.#i,objectTypes:this.#t,objectTypesByConstructor:this.#r,registry:this.#n};this.#s=n.typeChecker=new Z(n),this.#o=new te(n),Object.freeze(this)}registerFunction(e,n){return this.#n.registerFunctionOverload(e,n),this}registerOperator(e,n){return this.#n.registerOperatorOverload(e,n),this}registerType(e,n){return this.#n.registerType(e,n),this}registerVariable(e,n){if(this.#e.has(e))throw new Error(`Variable already registered: ${e}`);return this.#e.set(e,this.#n.getType(n)),this}hasVariable(e){return this.#e.has(e)}check(e){try{let n=this.#s.check(new D(e).parse());return{valid:!0,type:this.#a(n)}}catch(n){return{valid:!1,error:n}}}#u(e){try{let n=this.#s.check(e);return{valid:!0,type:this.#a(n)}}catch(n){return{valid:!1,error:n}}}#a(e){return e.name==="list<dyn>"?"list":e.name==="map<dyn, dyn>"?"map":`${e.name}`}parse(e){let n=new D(e).parse(),r=this.#c.bind(this,n);return r.check=this.#u.bind(this,n),r.ast=n,r}evaluate(e,n){return this.#c(new D(e).parse(),n)}#c(e,n){let r=this.#o;return r.ctx.setPrimaryContext(n),r.eval(e)}};function _e(t){throw new l(`Unsupported type: ${t}`)}var te=class{handlers=rt;celTypes=G;constructor({environment:e,registry:n,variables:r,functions:s,objectTypes:i,objectTypesByConstructor:o,typeChecker:c,ctx:h}){this.environment=e,this.variables=r,this.objectTypes=i,this.objectTypesByConstructor=o,this.functions=s,this.registry=n,this.typeChecker=c,!h&&(this.ctx=new ye(new Map(Object.entries(O))))}get overloads(){return this.registry.overloads}getUnaryOverload(e,n){return this.registry.overloads[e]?.get(n)}getBinaryOverload(e,n,r){return e?.get(n)?.get(r)}predicateEvaluator(e,n){return new we(this,e,n)}debugType(e){switch(typeof e){case"string":return this.celTypes.string;case"bigint":return this.celTypes.int;case"number":return this.celTypes.double;case"boolean":return this.celTypes.bool;case"object":return e===null?this.celTypes.null:this.objectTypesByConstructor.get(e.constructor)?.type||_e(e.constructor?.name||typeof e);default:_e(typeof e)}}tryCheck(e){try{return e.checkedType||this.typeChecker.check(e)}catch{}}eval(e){let n=this.handlers.get(e[0]);if(n)return n(e,this);throw new l(`Unknown operation: ${e[0]}`,e)}isDynamic(e){return this.tryCheck(e)?.kind==="dyn"}},we=class extends te{constructor(e,n,r){super(e);let[s,i]=r[3];if(s?.[0]!=="id")throw new l(`${n} invalid predicate iteration variable`,r);this.ast=r,this.functionName=n,this.predicateVariable=s[1],this.predicateExpression=i;let o=r[2].checkedType||this.celTypes.dyn,c=this.celTypes.dyn;o.type==="list"&&(c=o.valueType),o.type==="map"&&(c=o.keyType),this.variables=new me(this.variables,this.predicateVariable,c),this.ctx=new de(this.predicateVariable)}prepare(e,n){return this.ctx.setContext(e.ctx),this.getIterableItems(n)}getIterableItems(e){if(Array.isArray(e))return e;if(e instanceof Set)return[...e];if(e instanceof Map)return[...e.keys()];if(typeof e=="object")return Object.keys(e);throw new l(`${this.functionName} cannot iterate over non-collection type. argument must be a list, map, or object`,this.ast)}childEvaluateBool(e){switch(this.ctx.setOverride(e),this.eval(this.predicateExpression)){case!0:return!0;case!1:return!1;default:throw new l(`${this.functionName} predicate result is not a boolean`,Array.isArray(this.predicateExpression)?this.predicateExpression:this.ast)}}childEvaluate(e){return this.ctx.setOverride(e),this.eval(this.predicateExpression)}},Te=new K({unlistedVariablesAreDyn:!0});function Pe(t){return Te.parse(t)}function ze(t,e){return Te.evaluate(t,e)}function Ve(t){return Te.check(t)}function Ye(t){if(t===null)return"null";if(typeof t=="boolean"||typeof t=="bigint")return String(t);if(typeof t=="string")return ot(t);if(t instanceof Uint8Array)return Ge(t);if(typeof t=="number")return t%1===0?`${t}.0`:t.toLocaleString("en-US",{useGrouping:!1,maximumFractionDigits:9});if(typeof t=="object"){let e=Object.keys(t);if(e.every(n=>/^\d+$/.test(n))){let n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=t[r];return Ge(n)}}return String(t)}function v(t){if(Array.isArray(t)&&t[0]==="value")return Ye(t[1]);let[e,...n]=t;switch(e){case"value":return Ye(n[0]);case"id":return n[0];case"||":case"&&":case"==":case"!=":case"<":case"<=":case">":case">=":case"in":case"+":case"-":case"*":case"/":case"%":return`${A(n[0],e)} ${e} ${A(n[1],e)}`;case"!_":return`!${A(n[0],e)}`;case"-_":return n[0]instanceof f&&["+","-","*","/","%"].includes(n[0][0])?`-(${v(n[0])})`:`-${v(n[0])}`;case".":return`${A(n[0],e)}.${n[1]}`;case"[]":return`${A(n[0],e)}[${v(n[1])}]`;case"call":return`${n[0]}(${n[1].map(v).join(", ")})`;case"rcall":return`${A(n[1],e)}.${n[0]}(${n[2].map(v).join(", ")})`;case"list":return`[${n[0].map(v).join(", ")}]`;case"map":return`{${n[0].map(([r,s])=>`${v(r)}: ${v(s)}`).join(", ")}}`;case"?:":return`${A(n[0],e)} ? ${A(n[1],e)} : ${v(n[2])}`;default:throw new Error(`Unknown AST operation: ${e}`)}}function ot(t){let e=t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\f/g,"\\f").replace(/[\b]/g,"\\b").replace(/\v/g,"\\v"),n="";for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);s<32||s>126?n+=s<=65535?`\\u${s.toString(16).padStart(4,"0")}`:`\\U${s.toString(16).padStart(8,"0")}`:n+=e[r]}return`"${n}"`}function Ge(t){let e='b"';for(let n of t)n===92?e+="\\\\":n===34?e+='\\"':n===10?e+="\\n":n===13?e+="\\r":n===9?e+="\\t":n>=32&&n<=126?e+=String.fromCharCode(n):e+=`\\x${n.toString(16).padStart(2,"0")}`;return`${e}"`}var He={"?:":1,"||":2,"&&":3,"==":4,"!=":4,"<":5,"<=":5,">":5,">=":5,in:5,"+":6,"-":6,"-_":6,"*":7,"/":7,"%":7,"!_":8,".":9,"[]":9,call:9,rcall:9};function at(t,e){if(!(t instanceof f))return!1;let n=t[0],r=He[e]||0,s=He[n]||0;return n==="value"||n==="id"||n==="call"||n==="rcall"||n==="list"||n==="map"||(e==="*"||e==="/"||e==="%")&&n==="-_"||e==="*"&&n==="*"&&t[1]instanceof f&&t[1][0]==="-_"||(n==="."||n==="[]")&&(e==="."||e==="[]"||e==="rcall")?!1:e==="?:"?n==="?:":e==="!_"||e==="-_"?s<r:!!(e==="/"&&(n==="*"||n==="+"||n==="-")||n==="/"&&e!==void 0||(e==="*"||e==="/")&&["+","-","*","/"].includes(n)&&t.length>2&&t[1]instanceof f&&t[2]instanceof f||s<r||s===r&&(e==="/"||e==="%")&&(n==="/"||n==="%"))}function A(t,e){return at(t,e)?`(${v(t)})`:v(t)}var Ut={parse:Pe,evaluate:ze,check:Ve,Environment:K,ParseError:y,EvaluationError:l,TypeError:d,serialize:v};export{K as Environment,l as EvaluationError,y as ParseError,d as TypeError,Ve as check,Ut as default,ze as evaluate,Pe as parse,v as serialize};
