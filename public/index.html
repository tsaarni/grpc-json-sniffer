<!doctype html>
<html lang="en">

    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="grpc-viewer.css" />
        <script type="module">
            import { GrpcViewer } from './grpc-viewer.js';
            document.addEventListener('DOMContentLoaded', () => {
                // eslint-disable-next-line no-unused-vars
                const _app = new GrpcViewer();
            });
        </script>
        <title>gRPC Viewer</title>
    </head>

    <body>

        <!-- Message List panel on the left -->
        <div id="message-list-panel">
            <div id="filter-input-container">
                <input id="message-list-filter-input" type="text" placeholder="Filter using CEL expression (e.g., method.contains('Foo'))" />
                <button id="filter-clear-button">×</button>
                <div id="filter-error-tooltip" class="tooltip hidden"></div>
            </div>

            <button id="message-list-clear-button">Clear Messages</button>
            <div id="legend">
                <strong>Legend:</strong>
                <span class="legend-item legend-receive"></span>
                <span>Receive</span>
                <span class="legend-item legend-send"></span>
                <span>Send</span>
                <span class="legend-spacer"></span>
                <a href="#" id="filter-help-link">Filter Help</a>
                <input class="legend-item" type="checkbox" id="timezone" />
                <label for="timezone">UTC</label>
            </div>

            <!-- Container for the messages list -->
            <div id="messages-list-container"></div>

        </div>

        <!-- Resizer between the two panels -->
        <div id="resizer"></div>

        <!-- Message Details panel on the right -->
        <div id="message-details">
            <h3>Message Details</h3>
            <div id="details-content">Select a message to view details</div>
        </div>

        <!-- Filter help popup -->
        <div id="filter-help-popup" class="hidden">

            <button id="filter-help-close-button">×</button>
            <strong>Filter Query Syntax (CEL - Common Expression Language)</strong>

            <p>Available Fields:</p>
            <ul>
                <li><code>message_id</code> (int) - Sequential message identifier</li>
                <li><code>stream_id</code> (int) - Stream identifier for the message</li>
                <li><code>direction</code> (string) - Either "send" or "recv"</li>
                <li><code>time</code> (string) - Timestamp in ISO 8601 format</li>
                <li><code>method</code> (string) - gRPC method name (e.g., "/demo.Demo/Countdown")</li>
                <li><code>message</code> (string) - Message type name (e.g., "demo.CountdownReply")</li>
                <li><code>peer_address</code> (string) - Remote peer address</li>
                <li><code>content</code> (map) - The message payload itself</li>
                <li><code>error</code> (string, optional) - Error message if present</li>
            </ul>

            <p>Operators:</p>
            <ul>
                <li><code>==</code>, <code>!=</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code></li>
                <li><code>&amp;&amp;</code> (and), <code>||</code> (or), <code>!</code> (not)</li>
                <li><code>in</code> - e.g., <code>"Countdown" in method</code></li>
            </ul>

            <p>String Methods:</p>
            <ul>
                <li><code>.contains(substring)</code> - Check if string contains substring</li>
                <li><code>.startsWith(prefix)</code> - Check if string starts with prefix</li>
                <li><code>.endsWith(suffix)</code> - Check if string ends with suffix</li>
                <li><code>.matches(regex)</code> - Check if string matches regex pattern</li>
            </ul>

            <p>Examples:</p>
            <ul>
                <li><code>method.contains('Countdown')</code> - Methods containing "Countdown"</li>
                <li><code>direction == 'recv'</code> - Only received messages</li>
                <li><code>stream_id == 1</code> - Messages from stream 1</li>
                <li><code>content.value &gt; 5</code> - Content field value greater than 5</li>
                <li><code>method.startsWith('/demo') &amp;&amp; direction == 'send'</code> - Combined conditions</li>
                <li><code>message.matches('.*Reply')</code> - Messages ending with "Reply"</li>
            </ul>

            See <a href="https://github.com/marcbachmann/cel-js" target="_blank">cel-js documentation</a> for more details.
        </div>

        <!-- Templates -->

        <!-- Message list row template -->
        <template id="message-list-template">
            <div class="message-row-content">
                <span class="message-row-message-id"></span>
                <span class="message-row-timestamp"></span>
                <span class="message-row-method-and-message"></span>
            </div>
        </template>

        <!-- Message details template -->
        <template id="message-details-template">
            <div class="message-details-content">
                <div class="message-details-metadata">
                    <div class="message-details-row">
                        <span class="message-details-label">message_id:</span>
                        <span id="message-details-message-id-value"></span>
                    </div>
                    <div id="message-details-stream-id" class="message-details-row hidden">
                        <span class="message-details-label">stream_id:</span>
                        <span id="message-details-stream-id-value"></span>
                    </div>
                    <div class="message-details-row">
                        <span class="message-details-label">time:</span>
                        <span id="message-details-timestamp-value"></span>
                    </div>
                    <div class="message-details-row">
                        <span class="message-details-label">method:</span>
                        <span id="message-details-method-value"></span>
                    </div>
                    <div class="message-details-row">
                        <span class="message-details-label">message:</span>
                        <span id="message-details-message-value"></span>
                    </div>
                    <div class="message-details-row">
                        <span class="message-details-label">direction:</span>
                        <span id="message-details-direction-value"></span>
                    </div>
                    <div class="message-details-row">
                        <span class="message-details-label">peer_address:</span>
                        <span id="message-details-peer-address-value"></span>
                    </div>
                    <div id="message-details-error" class="message-details-row hidden">
                        <span class="message-details-label">error:</span>
                        <span id="message-details-error-value"></span>
                    </div>
                </div>
                <div>
                    <pre id="message-details-payload-value"></pre>
                </div>
            </div>
        </template>

    </body>

</html>
